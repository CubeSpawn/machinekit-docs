:lang: fr
:toc:

= Mises à jour de LinuxCNC


== Mise à jour 2.4.x à 2.5.x

La version 2.5.0 de LinuxCNC change de nom, elle passe de "EMC2" vers
"LinuxCNC". Tous les programmes dont les noms contenaient "emc" ont été
renommés pour contenir "linuxcnc". Toute la documentation à été mise à jour.

Additionally, the name of the debian package containing the software
has changed. Unfortunately this breaks automatic upgrades. To upgrade
from emc2 2.4.X to linuxcnc 2.5.X, do the following:

=== On Ubuntu Lucid 10.04

First you need to tell your computer where to find the new LinuxCNC
software:

* Click on the System menu in the top panel and select
  Administration->Software Sources.

* Select the Other Software tab.

* Select the entry that says

    http://linuxcnc.org/lucid lucid base emc2.4

    or

    http://linuxcnc.org/lucid lucid base emc2.4-sim

    and click the Edit button.

* In the Components field, change `emc2.4` to `linuxcnc2.5`, or change
  `emc2.4-sim` to `linuxcnc2.5-sim`.

* Click the OK button.

* Back in the Software Sources window, Other Software tab, click the
  Close button.

* It will pop up a window informing you that the information about
  available software is out-of-date. Click the Reload button.

Now your computer knows about the new software, next we need to tell
it to install it:

* Click on the System menu in the top panel and select
  Administration->Synaptic Package Manager

* In the Quick Search bar at the top, type `linuxcnc`.

* Click the check box to mark the new linuxcnc package for installation.

* Click the Apply button, and let your computer install the new
  package. The old emc 2.4 package will be automatically removed to make
  room for the new LinuxCNC 2.5 package.

=== On Ubuntu Hardy 8.04

First you need to tell your computer where to find the new LinuxCNC software:

* Click on the System menu in the top panel and select Administration->Synaptic Package Manager

* Go to Settings->Repositories.

* Select the "Third-Party Software" tab.

* Select the entry that says

    http://linuxcnc.org/hardy hard emc2.4

    or

    http://linuxcnc.org/hardy hardy emc2.4-sim

    and click the Edit button.

* In the Components field, change `emc2.4` to `linuxcnc2.5` or `emc2.4-sim` to `linuxcnc2.5-sim`.

* Click the OK button.

* Back in the Software Sources window, click the Close button.

* Back in the Synaptic Package Manager window, click the Reload button.


Now your computer knows about the new software, next we need to tell it to install it:

* In the Synaptic Package Manager, click the Search button.

* In the Find dialog window that pops up, type `linuxcnc` and click the
  Search button.

* Click the check-box to mark the linuxcnc package for installation.

* Click the Apply button, and let your computer install the new
  package. The old emc 2.4 package will be automatically removed to make
  room for the new LinuxCNC 2.5 package.

== Config changes

Les configurations utilisateur ont migré de $HOME/emc2 vers $HOME/linuxcnc,
il sera nécessaire de renommer l'ancien répertoire si il existe, ou de déplacer
les fichiers vers ce nouvel endroit.
Le watchdog de hostmod2 dans LinuxCNC 2.5 ne démarre qu'après que les threads
de HAL soient eux-même démarrés. Cela signifie qu'il tolère désormais un
délai d'attente de l'ordre de la période servo thread, au lieu de nécessiter
un délai qui soit de l'ordre du temps entre le chargement du pilote
et le démarrage des threads de HAL. Ce qui signifie, de l'ordre de quelques
millisecondes (quelques périodes du thread servo) au lieu de plusieurs 
centaines de millisecondes préalablement. La valeur par défaut est descendue
de 1 seconde à 5 millisecondes. Vous ne devriez donc plus avoir a ajuster le
délai du watchdog, à moins que vous ne modifiez la période du threads servo.

Les anciens pilotes pour les cartes Mesa 5i20, hal_m5i20, ont été enlevés, ils
étaient obsolètes et remplacés par hostmot2 depuis 2009 (version 2.3.) 
Si vous utilisiez ces pilotes, vous devrez reconstruire une nouvelle
configuration utilisant le pilote hostmod2. Pncconf peux vous y aider et il
contient quelques exemples de configurations (hm2-servo et hm2-stepper)
qui vous serviront d'exemple.

== Mise à jour 2.3.x à 2.4.x

Les instructions suivantes s’appliquent à Ubuntu 8.04 "Hardy Heron". 
LinuxCNC 2.4 n'est pas disponible pour des versions plus anciennes de Ubuntu.

En raison de plusieurs incompatibilités mineures entre les versions 2.3.5 et 2.4.x,
votre installation existante ne sera pas automatiquement mise à jour vers la version 
2.4.x. Si vous voulez exécuter la version 2.4.x, veuillez modifier 
le dépôt LinuxCNC-2.4 en suivant ces instructions :

Lancez Système/Administration/Gestionnaire de paquets Synaptic
Sélectionnez Configuration/Dépôt
Dans l'onglet "Autres logiciels" vous trouverez deux lignes 
concernant linuxcnc.org.

Pour chacune:

- Sélectionnez la ligne et cliquez sur le bouton "Editer"
- Dans le champ composants remplacez emc2.3 par emc2.4
- Cliquez sur "Valider" 
- Fermer la fenêtre "Source de logiciels" avec le bouton fermer
- Cliquez sur "Recharger" dans la barre d'outils
- Cliquez sur "Tout mettre à jour" dans la barre d'outils
   
.Utilisateurs de carte Mesa et hostmot2 :

**********
Si vous utilisez une carte _mesa_, trouvez le paquet 
hostmot2-firmware approprié à votre carte et marquez-le pour 
l'installation. Astuce: faites une recherche "hostmot2-firmware"
dans gestionnaire de paquet Synaptic.
**********

 - Cliquez "Appliquer"

== Changements entre 2.3.x et 2.4.x

Une fois que vous avez fait la mise à jour, mettez à jour les 
configurations personnalisées en suivant ces instructions

=== Changement emc.nml (2.3.x to 2.4.x)

Pour les configurations qui ont personnalisé emc.nml, enlevez la ligne 
`NML_FILE = emc.nml` dans le fichier inifile. Cela forcera l'utilisation 
de la version la plus à jour de emc.nml.

Pour les configurations qui n'ont pas personnalisé emc.nml, 
un changement similaire est requis.

Un échec de cette opération provoque une erreur comme: 
----
libnml/buffer/physmem.cc 143: PHYSMEM_HANDLE: 
Can't write 10748 bytes at offset 60 from buffer of size 10208.
----

=== Changements de la table d'outils (2.3.x to 2.4.x) 

Le nouveau format de la table d'outil est incompatible. 
La documentation explique le nouveau format. 
La table d'outil sera automatiquement convertie dans le nouveau format.

=== Images du micro logiciel hostmot2 (2.3.x to 2.4.x)

Les images du micro logiciel hostmot2 sont dorénavent dans un paquet séparé. 
Vous pouvez :

- Continuer à utiliser un paquet déjà installé `emc2-firmware-mesa-*`
- Installer les nouveaux paquets du gestionnaire de paquets Synaptic. 
   Les nouveaux paquets sont nommés `hostmot2-firmware-*`
- Télécharger les fichiers .tar des images du microprogramme depuis 
   http://emergent.unpy.net/01267622561 et les installer manuellement. 

// vim: set syntax=asciidoc:


