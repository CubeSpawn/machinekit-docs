= Updating LinuxCNC

== Updating from 2.4.x to 2.5.x

Release 2.5.0 of LinuxCNC switched the name from "EMC2" to "LinuxCNC". All
programs with "emc" in the name changed to "linuxcnc" instead. All
documentation was updated.

The user configs moved from $HOME/emc2 to $HOME/linuxcnc, so you will
need to rename your directory, or move your files to the new place.

The hostmot2 watchdog in LinuxCNC 2.5 does not start running until the
HAL threads start running. This means it now tolerates a timeout on the
order of the servo thread period, instead of requiring a timeout that's
on the order of the time between loading the driver and starting the HAL
threads. This typically means a few milliseconds (a few times the servo
thread period) instead of many hundreds of milliseconds. The default
has been lowered from 1 second to 5 milliseconds. You generally don't
need to set the hm2 watchdog timeout any more, unless you've changed
your servo thread period.

The old driver for the Mesa 5i20, hal_m5i20, has been removed after being
deprecated in favor of hostmot2 since early 2009 (version 2.3.) If you
are still using this driver, you will need to build a new configuration
using the hostmot2 driver. Pncconf may help you do this, and we have
some sample configs (hm2-servo and hm2-stepper) that act as examples.

== Upgrading from 2.3.x to 2.4.x

The following instructions only apply to Ubuntu 8.04 "Hardy Heron". 
LinuxCNC 2.4 is not available for older releases of Ubuntu.

Because there are several minor incompatibilities between 2.3.5 
and 2.4.x, your existing install will not automatically be 
updated to 2.4.x. If you want to run 2.4.x, change to the LinuxCNC-2.4 
repository by following these instructions:

run System/Administration/Synaptic Package Manager

go to Settings/Repositories

In the list of Third-Party software there should be at least two 
lines for linuxcnc.org.

For each of them:

* Select the line and click Edit
* On the Components line, change emc2.3 to emc2.4
* Click OK 
* Close the 'Software Preferences' window
* Click 'Reload' as instructed
* Click 'Mark All Upgrades'
   
.Mesa card and hostmot2 users:
**********
If you use a mesa card, find the proper hostmot2-firmware package 
for your card and mark it for installation. Hint: do a search for 
'hostmot2-firmware' in the synaptic package manager.
**********

* Click 'Apply' 

== Changes between 2.3.x and 2.4.x

Once you have done the upgrade, update any custom configurations 
by following these instructions:

=== emc.nml changes (2.3.x to 2.4.x)

For configurations that have not customized emc.nml, 
remove or comment out the inifile line NML_FILE = emc.nml. 
This will cause the most up to date version of emc.nml to be used.

For configurations that have customized emc.nml, 
a change similar to this one is required.

Failure to do this can cause an error like this one: 
---------------------------------- 
libnml/buffer/physmem.cc 143: PHYSMEM_HANDLE: 
Can't write 10748 bytes at offset 60 from buffer of size 10208.
----------------------------------

=== tool table changes (2.3.x to 2.4.x) 

The format of the tool table has been changed incompatibly. 
The documentation shows the new format. 
The tool table will automatically be converted to the new format.

=== hostmot2 firmware images (2.3.x to 2.4.x)

The hostmot2 firmware images are now a separate package. You can:

 - Continue using an already-installed 'emc2-firmware-mesa-*' 2.3.x package
 - Install the new packages from the synaptic package manager. 
   The new packages are named 'hostmot2-firmware-*'
 - Download the firmware images as tar files from 
   http://emergent.unpy.net/01267622561 and install them manually 

// vim: set syntax=asciidoc:


